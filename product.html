<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù…Ù†ØªØ¬ | Ù…ØªØ¬Ø± Ù‡Ø¯Ø§ÙŠØ§ Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª</title>
  <meta name="robots" content="noindex, follow" />
  <link rel="preload" href="./css/performance-critical.css" as="style">
  <link rel="stylesheet" href="./css/performance-critical.css">
  <style>
    .product-shell{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:40px;background:#f5f5f5}
    .card{max-width:1200px;width:100%;background:#fff;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.08);overflow:hidden}
    .card__header{padding:18px 22px;background:linear-gradient(135deg,#FFD700,#D4AF37);color:#2c3e50;font-weight:700}
    .card__body{padding:24px}
    .loading{opacity:.6;filter:grayscale(10%)}
    .error{padding:22px;border-right:5px solid #e74c3c;background:#fff3f3;border-radius:10px}
    .suggest-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px;margin-top:16px}
    .suggest-card{border:1px solid #eee;border-radius:12px;padding:12px;background:#fff}
    .suggest-card img{width:100%;height:180px;object-fit:cover;border-radius:10px}
    .suggest-card h4{font-size:16px;margin:8px 0 6px;color:#2c3e50;line-height:1.4}
    .suggest-card .price{display:flex;gap:10px;align-items:center}
    .old{color:#999;text-decoration:line-through}
    .now{color:#667eea;font-weight:700}
    .btn{display:inline-flex;align-items:center;justify-content:center;padding:10px 14px;border-radius:10px;text-decoration:none}
    .btn-primary{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}
    .btn-wa{background:linear-gradient(135deg,#25D366,#20b358);color:#fff}
    .header{background:linear-gradient(135deg,#FFD700,#D4AF37);box-shadow:0 2px 10px rgba(212,175,55,.15)}
  </style>
</head>
<body>
  <header class="header">
    <div class="container header__inner" style="max-width:1200px;margin:0 auto;padding:12px 16px;display:flex;justify-content:space-between;align-items:center">
      <a href="./" class="logo" style="font-weight:800;color:#2c3e50;text-decoration:none">ğŸ›ï¸ Ù…ØªØ¬Ø± Ù‡Ø¯Ø§ÙŠØ§ Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª</a>
      <nav class="main-nav"><a href="./">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a><a href="./blog.html">Ø§Ù„Ù…Ø¯ÙˆÙ†Ø©</a><a href="./about.html">Ù…Ù† Ù†Ø­Ù†</a></nav>
    </div>
  </header>

  <main class="product-shell">
    <div class="card">
      <div class="card__header">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬</div>
      <div class="card__body">
        <div id="product-root" class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
      </div>
    </div>
  </main>

  <footer class="site-footer" style="margin-top:30px">
    <div class="container" style="max-width:1200px;margin:0 auto;padding:20px;color:#555;text-align:center">Â© 2025 Ù…ØªØ¬Ø± Ù‡Ø¯Ø§ÙŠØ§ Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª</div>
  </footer>

  <script>
    // â€”â€”â€” Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª â€”â€”â€”
    const PRODUCTS_DIR = 'products';

    // Ù‚Ø±Ø§Ø¡Ø© Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… (?p=)
    function getRequestedProductFile() {
      const url = new URL(location.href);
      // Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ù„Ø§Ø³Ù… Ù…Ù„Ù ØµØ±ÙŠØ­ ?file=... Ø«Ù… Ø³Ø¨ÙŠÙƒØ© Ø§Ø³Ù… ?slug=... Ø«Ù… Ø§Ù„Ù…Ø³Ø§Ø± Ù†ÙØ³Ù‡
      const direct = url.searchParams.get('file');
      if (direct) return direct.endsWith('.html') ? direct : direct + '.html';

      const slug = url.searchParams.get('slug');
      if (slug) return slug + '.html';

      // Ø¯Ø¹Ù… Ø§Ù„Ù…Ø³Ø§Ø±: /product.html?Rolex-GMT-Batman Ø£Ùˆ /product.html?Ø±ÙˆÙ„ÙƒØ³-...
      const q = url.search.replace(/^\?/,'');
      if (q && !q.includes('=')) return decodeURIComponent(q) + '.html';

      // Ø¯Ø¹Ù… Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù…Ù† Ù†ÙˆØ¹ /products/Ø§Ø³Ù…-Ø§Ù„Ù…Ù„Ù.html Ø¹Ø¨Ø± Ø§Ù„Ù€ referrer (Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¹ 404)
      const path = url.pathname;
      const lastSegment = path.split('/').pop();
      if (lastSegment && lastSegment.endsWith('.html')) return lastSegment;

      return null;
    }

    // ØªÙˆÙ„ÙŠØ¯ Ø£ÙƒÙˆØ§Ø¯ Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© Ù…Ù† Ø§Ù„Ø§Ø³Ù… Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø±Ù…ÙˆØ²
    function normalizeCandidates(name) {
      if (!name) return [];
      const base = decodeURIComponent(name)
        .replace(/\s+/g, '-')
        .replace(/Ù€/g,'-')
        .replace(/[\u064B-\u065F]/g,'') // Ø­Ø±ÙƒØ§Øª
        .replace(/[\u0610-\u061A\u06D6-\u06ED]/g,'') // Ø¹Ù„Ø§Ù…Ø§Øª Ù‚Ø±Ø¢Ù†ÙŠØ©
        .replace(/[^\w\u0600-\u06FF\-\.]/g,'')
        .replace(/--+/g,'-')
        .replace(/^-+|-+$/g,'');
      const variations = new Set([
        base,
        base.replace(/\.html$/i,'') + '.html',
        base.replace(/â€“|â€”/g,'-'),
        base.replace(/_/g,'-'),
      ]);
      return Array.from(variations);
    }

    // ØªØ¬Ø±Ø¨Ø© ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    async function tryFetchProduct(fileName) {
      const url = `${PRODUCTS_DIR}/${fileName}`;
      const res = await fetch(url, { cache: 'no-store' });
      if (res.ok) return await res.text();
      throw new Error(res.status + ' ' + res.statusText);
    }

    // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¯Ø§Ø®Ù„ repo (Ù…Ø¨Ù†ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ù†Ø§Ø¡) - Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡Ø§ Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒÙŠØ§Ù‹ Ø¥Ù† Ù„Ø²Ù…
    const KNOWN_FILES = [];

    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù…Ù„Ù Ù…Ù† Ø§Ø³Ù… Ù‚Ø±ÙŠØ¨
    async function findProductFile(requested) {
      if (!requested) return null;
      const candidates = normalizeCandidates(requested);
      // Ø¬Ø±Ù‘Ø¨ Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ† Ù…Ø¨Ø§Ø´Ø±Ø©
      for (const c of candidates) {
        try { await tryFetchProduct(c); return c; } catch(e) {}
      }
      // Ø¥Ù† ÙØ´Ù„ØŒ Ø¬Ø±Ù‘Ø¨ Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ† Ù…Ø¹ ØªØ±Ù…ÙŠØ² URL
      for (const c of candidates) {
        try { await tryFetchProduct(encodeURIComponent(c)); return encodeURIComponent(c); } catch(e) {}
      }
      // Ø¥Ù† ÙØ´Ù„ØŒ ÙˆØ­Ù‘Ø¯ Ø´ÙƒÙ„ Ø§Ù„Ø´Ø±Ø·Ø©
      for (const c of candidates) {
        const alt = c.replace(/-/g, '%20');
        try { await tryFetchProduct(alt); return alt; } catch(e) {}
      }
      // ÙƒÙ…Ù„Ø§Ø° Ø£Ø®ÙŠØ±ØŒ Ù„Ùˆ ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ù…Ø¹Ø±ÙØ© Ù…Ø³Ø¨Ù‚Ø§Ù‹
      for (const known of KNOWN_FILES) {
        if (known.toLowerCase() === requested.toLowerCase()) {
          try { await tryFetchProduct(known); return known; } catch(e) {}
        }
      }
      return null;
    }

    // Ø¥Ø¯Ø±Ø§Ø¬ HTML Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ø¹ ØªØµØ­ÙŠØ­ Ø±ÙˆØ§Ø¨Ø· CSS Ù„Ù„Ù†Ø³Ø¨ÙŠØ©
    function renderInShell(html) {
      const root = document.getElementById('product-root');
      // Ø¹Ø¯Ù‘Ù„ Ù…Ø³Ø§Ø± Ø§Ù„Ø³ØªØ§ÙŠÙ„ Ø¥Ù„Ù‰ ../css -> ./css Ù„Ø£Ù†Ù†Ø§ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¬Ø°Ø±
      html = html.replace(/href=\"\.\.\/css\//g, 'href="./css/');
      // Ø¹Ø¯Ù‘Ù„ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙ†Ù‚Ù„ Ø¥Ù„Ù‰ Ù†Ø³Ø¨ÙŠØ© Ù„Ù„Ø¬Ø°Ø±
      html = html.replace(/href=\"\.\.\//g, 'href="./');
      root.innerHTML = html;
      root.classList.remove('loading');
    }

    // Ø¹Ø±Ø¶ ØµÙØ­Ø© 404 Ù…Ø®ØµØµØ© Ù…Ø¹ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª
    async function render404() {
      const root = document.getElementById('product-root');
      // Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ù…Ù† API Repo (Ø³ÙŠØªØ¬Ø§ÙˆØ² CORS Ø£Ø­ÙŠØ§Ù†Ø§Ù‹) â€” Ù„Ø°Ù„Ùƒ Ù†Ø¶Ø¹ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø«Ø§Ø¨ØªØ© fallback
      const suggestions = [
        { t:'ARIAF', p:281, o:381, img:'https://m5zoon.com/public/uploads/products/1758995115569006.webp', f:'ARIAF.html' },
        { t:'Rolex GMT Batman', p:315, o:365, img:'https://m5zoon.com/public/uploads/products/1746181464408885.webp', f:'Rolex-GMT-Batman.html' },
        { t:'Kayali Vanilla', p:275, o:365, img:'https://m5zoon.com/public/uploads/products/1745381628569021.webp', f:'Kayali-Vanilla.html' }
      ];

      root.innerHTML = `
        <div class="error">
          <h3>Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ Ø£Ùˆ Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ­ÙŠØ­</h3>
          <p>Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬. Ø¬Ø±Ù‘Ø¨ Ø£Ø­Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:</p>
          <div class="suggest-grid">
            ${suggestions.map(s => `
              <div class="suggest-card">
                <img src="${s.img}" alt="${s.t}">
                <h4>${s.t}</h4>
                <div class="price"><span class="old">${s.o} Ø¯.Ø¥</span><span class="now">${s.p} Ø¯.Ø¥</span></div>
                <div style="display:flex;gap:8px;margin-top:10px">
                  <a class="btn btn-primary" href="./product.html?file=${encodeURIComponent(s.f)}">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬</a>
                  <a class="btn btn-wa" target="_blank" href="https://wa.me/201110760081?text=${encodeURIComponent('Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø±ØºØ¨ ÙÙŠ Ø·Ù„Ø¨: '+s.t+'\nØ§Ù„Ø³Ø¹Ø±: '+s.p+' Ø¯.Ø¥')}">Ø§Ø·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨</a>
                </div>
              </div>
            `).join('')}
          </div>
        </div>`;

      root.classList.remove('loading');
    }

    (async function init(){
      const requested = getRequestedProductFile();
      const file = await findProductFile(requested);
      if (file) {
        try {
          const html = await tryFetchProduct(file);
          renderInShell(html);
          return;
        } catch(e) {}
      }
      await render404();
    })();
  </script>
</body>
</html>

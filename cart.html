<!DOCTYPE html>
<html lang="ar-AE" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سلة التسوق | متجر هدايا الإمارات | تقييمات ممتازة ⭐</title>
    <meta name="description" content="عرض وإدارة منتجاتك المختارة في سلة التسوق مع عرض التقييمات الاحترافية - اتمم طلبك بسهولة عبر واتساب">
    <link rel="canonical" href="https://emirates-gifts.arabsad.com/cart.html">
    
    <!-- DNS Prefetch لتحسين الأداء -->
    <link rel="dns-prefetch" href="https://m5zoon.com">
    <link rel="dns-prefetch" href="https://wa.me">
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="./css/performance-critical.css" as="style">
    <link rel="preload" href="./js/performance-optimizer.js" as="script">
    
    <!-- Critical CSS مدمج -->
    <style>
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:linear-gradient(135deg,#fdfbfb 0%,#f8f6f0 100%);color:#2C3E50;direction:rtl;margin:0;padding:0;font-display:swap}
        .container{max-width:1000px;margin:0 auto;padding:0 15px;contain:layout}
        .cart-page{padding:40px 20px;min-height:calc(100vh - 200px)}
        .cart-container{max-width:1000px;margin:0 auto;background:white;border-radius:20px;padding:40px;box-shadow:0 15px 40px rgba(0,0,0,0.1);contain:layout style paint}
        .cart-header{text-align:center;margin-bottom:40px;padding-bottom:25px;border-bottom:3px solid #FFD700}
        .cart-header h1{font-size:clamp(2rem,5vw,2.8rem);color:#2c3e50;margin-bottom:12px;background:linear-gradient(135deg, #FFD700, #D4AF37);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .cart-item{display:flex;align-items:center;gap:20px;padding:25px;border:2px solid #f1f3f4;border-radius:18px;margin-bottom:20px;background:#fafbfc;transition:all 0.3s ease;min-height:120px}
        .cart-item:hover{box-shadow:0 8px 25px rgba(0,0,0,0.12);border-color:#FFD700;transform:translateY(-2px)}
        .cart-item img{width:90px;height:90px;object-fit:cover;border-radius:15px;aspect-ratio:1/1;transition:opacity 0.3s ease}
        .item-details{flex:1}
        .item-title{font-size:1.35rem;font-weight:600;color:#2c3e50;margin-bottom:8px;line-height:1.3}
        .item-rating{display:flex;align-items:center;gap:10px;margin-bottom:12px;padding:8px 12px;background:rgba(255,215,0,0.1);border-radius:10px;width:fit-content}
        .item-rating .stars{color:#FFD700;font-size:16px;letter-spacing:1px}
        .item-rating .rating-number{font-weight:bold;color:#2c3e50;margin:0 5px}
        .item-rating .reviews-count{font-size:13px;color:#666}
        .item-price{font-size:1.25rem;font-weight:700;color:#D4AF37;margin-bottom:8px}
        .item-store{font-size:0.9rem;color:#666;font-style:italic}
        .quantity-controls{display:flex;align-items:center;gap:12px;background:white;border-radius:12px;padding:10px;border:2px solid #e9ecef}
        .quantity-btn{background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;width:36px;height:36px;border-radius:50%;cursor:pointer;font-weight:bold;display:flex;align-items:center;justify-content:center;font-size:18px;transition:all 0.2s ease}
        .quantity-btn:hover{transform:scale(1.1);box-shadow:0 4px 12px rgba(102,126,234,0.3)}
        .quantity-display{font-weight:bold;min-width:35px;text-align:center;font-size:1.1rem}
        .remove-item{background:linear-gradient(135deg,#e74c3c,#c0392b);color:white;border:none;padding:12px 18px;border-radius:10px;cursor:pointer;font-weight:600;transition:all 0.3s ease;font-size:0.9rem}
        .remove-item:hover{transform:translateY(-2px);box-shadow:0 6px 15px rgba(231,76,60,0.3)}
        .cart-summary{background:linear-gradient(135deg, #667eea, #764ba2);color:white;padding:35px;border-radius:20px;margin-top:35px;box-shadow:0 10px 30px rgba(102,126,234,0.2)}
        .summary-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px;font-size:1.15rem}
        .summary-total{font-size:1.6rem;font-weight:bold;padding-top:20px;border-top:2px solid rgba(255,255,255,0.3)}
        .checkout-actions{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:35px}
        .btn-checkout{background:linear-gradient(135deg,#25D366,#128C7E);color:white;padding:20px 30px;border:none;border-radius:15px;font-size:1.15rem;font-weight:700;cursor:pointer;text-decoration:none;text-align:center;display:flex;align-items:center;justify-content:center;gap:10px;transition:all 0.3s ease;box-shadow:0 6px 20px rgba(37,211,102,0.2)}
        .btn-checkout:hover{transform:translateY(-3px);box-shadow:0 12px 30px rgba(37,211,102,0.4)}
        .btn-continue{background:transparent;color:#667eea;border:3px solid #667eea;padding:20px 30px;border-radius:15px;font-size:1.15rem;font-weight:700;cursor:pointer;text-decoration:none;text-align:center;display:flex;align-items:center;justify-content:center;gap:10px;transition:all 0.3s ease}
        .btn-continue:hover{background:#667eea;color:white;text-decoration:none;transform:translateY(-2px)}
        .empty-cart{text-align:center;padding:80px 20px}
        .empty-cart-icon{font-size:5rem;margin-bottom:25px;opacity:0.6}
        .empty-cart h2{color:#2c3e50;margin-bottom:18px;font-size:1.8rem}
        .empty-cart p{color:#666;margin-bottom:35px;font-size:1.1rem}
        @media (max-width: 768px){.cart-container{padding:25px;margin:15px}.cart-item{flex-direction:column;text-align:center;gap:20px;padding:20px}.cart-item img{width:120px;height:120px}.checkout-actions{grid-template-columns:1fr;gap:15px}.cart-header h1{font-size:2.2rem}.quantity-controls{justify-content:center}}
        .scroll-progress{position:fixed;top:0;left:0;width:0%;height:4px;background:linear-gradient(90deg,#FFD700,#D4AF37);z-index:9999;transition:width 0.1s ease}
    </style>
    
    <link rel="stylesheet" href="./woodmart-lite.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="./css/performance-critical.css">
    <noscript><link rel="stylesheet" href="./woodmart-lite.css"></noscript>
    
    <!-- Open Graph -->
    <meta property="og:title" content="سلة التسوق - متجر هدايا الإمارات">
    <meta property="og:description" content="مراجعة منتجاتك وإتمام الطلب بسهولة عبر واتساب">
    <meta property="og:url" content="https://emirates-gifts.arabsad.com/cart.html">
</head>
<body>
    <!-- شريط التقدم -->
    <div class="scroll-progress" id="scrollProgress"></div>
    
    <!-- Skip Links للوصول -->
    <a href="#main-content" class="skip-link">انتقال إلى محتوى السلة</a>
    
    <!-- الخلفية الشفافة للقائمة -->
    <div class="mobile-overlay" id="mobileOverlay"></div>
    
    <!-- القائمة الجانبية -->
    <div class="mobile-sidebar" id="mobileSidebar">
        <div class="mobile-sidebar-header">
            <div class="mobile-sidebar-logo">متجر هدايا الإمارات</div>
            <button class="mobile-sidebar-close" id="closeSidebar" aria-label="إغلاق القائمة">✖</button>
        </div>
        <nav class="mobile-sidebar-nav">
            <a href="./">🏠 الرئيسية</a>
            <a href="./blog/">📝 المدونة</a>
            <a href="./products-showcase.html">🛍 عرض المنتجات</a>
            <a href="./cart.html" class="current-page">🛍 السلة</a>
            <a href="https://wa.me/201110760081" target="_blank">📱 واتساب</a>
        </nav>
    </div>
    
    <header class="header">
        <div class="header__inner container">
            <a href="./" class="header__logo">
                <h1>متجر هدايا الإمارات</h1>
            </a>
            
            <button class="mobile-menu-toggle" id="openSidebar" aria-label="فتح القائمة">
                <span class="menu-text">القائمة</span>
                <span class="menu-icon">☰</span>
            </button>
            
            <nav class="main-nav">
                <a href="./">🏠 الرئيسية</a>
                <a href="./blog/">📝 المدونة</a>
                <a href="./products-showcase.html">🛍 عرض المنتجات</a>
                <a href="https://wa.me/201110760081" target="_blank">
                    📱 واتساب
                </a>
            </nav>
        </div>
    </header>
    
    <main class="cart-page" id="main-content">
        <div class="cart-container">
            <div class="cart-header">
                <h1>🛍 سلة التسوق</h1>
                <p>مراجعة منتجاتك مع عرض التقييمات الاحترافية قبل إتمام الطلب</p>
            </div>
            
            <div id="cart-content">
                <!-- سيتم ملء المحتوى ديناميكياً -->
                <div class="loading-message" style="text-align: center; padding: 50px 20px; font-size: 1.2rem; color: #666;">
                    ⏳ جاري تحميل سلة التسوق...
                </div>
            </div>
        </div>
    </main>
    
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>متجر هدايا الإمارات</h3>
                    <p>متجركم الموثوق للعطور والساعات والهدايا الفاخرة في دولة الإمارات.</p>
                    <a href="https://wa.me/201110760081" target="_blank" class="whatsapp-contact">
                        📱 تواصل عبر واتساب
                    </a>
                </div>
                
                <div class="footer-section">
                    <h3>روابط مهمة</h3>
                    <ul>
                        <li><a href="./">الصفحة الرئيسية</a></li>
                        <li><a href="./products-showcase.html">عرض المنتجات</a></li>
                        <li><a href="./blog/">مدونة المتجر</a></li>
                        <li><a href="./sitemap.xml">خريطة الموقع</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer__bottom">
                <p>&copy; 2025 متجر هدايا الإمارات - جميع الحقوق محفوظة</p>
                <div class="social-links" style="margin-top: 12px;">
                    <a href="https://wa.me/201110760081" target="_blank" title="واتساب متجر هدايا الإمارات">📱</a>
                    <a href="./sitemap.xml" target="_blank" title="Sitemap">🗺️</a>
                    <a href="./merchant-feed.xml" target="_blank" title="Google Merchant Feed">🛍</a>
                </div>
            </div>
        </div>
    </footer>
    
    <button id="back-to-top" title="العودة إلى الأعلى" aria-label="العودة للأعلى">
        &#8593;
    </button>
    
    <!-- تحميل JavaScript محسّن -->
    <script src="./js/performance-optimizer.js" defer></script>
    <script src="./js/reviews-system.js" defer></script>
    <script src="./js/cart-system.js" defer></script>
    <script src="./js/main.js" defer></script>
    <script src="./js/blog-reviews.js" defer></script>
    
    <script type="module">
        // عناصر القائمة الجانبية
        const openBtn = document.getElementById('openSidebar');
        const closeBtn = document.getElementById('closeSidebar');
        const sidebar = document.getElementById('mobileSidebar');
        const overlay = document.getElementById('mobileOverlay');
        const scrollProgress = document.getElementById('scrollProgress');
        
        const openSidebar = () => {
            sidebar?.classList.add('open');
            overlay?.classList.add('active');
            document.body.style.overflow = 'hidden';
        };
        
        const closeSidebar = () => {
            sidebar?.classList.remove('open');
            overlay?.classList.remove('active');
            document.body.style.overflow = '';
        };
        
        openBtn?.addEventListener('click', openSidebar);
        closeBtn?.addEventListener('click', closeSidebar);
        overlay?.addEventListener('click', closeSidebar);
        document.addEventListener('keydown', (e) => e.key === 'Escape' && closeSidebar());
        
        // إدارة السلة مع التقييمات المحسّنة
        let cart = JSON.parse(localStorage.getItem('emirates-gifts-cart') || '[]');
        
        // تحديث كمية المنتج
        function updateQuantity(productId, change) {
            const itemIndex = cart.findIndex(item => item.id === productId);
            if (itemIndex !== -1) {
                cart[itemIndex].quantity += change;
                if (cart[itemIndex].quantity <= 0) {
                    cart.splice(itemIndex, 1);
                }
                localStorage.setItem('emirates-gifts-cart', JSON.stringify(cart));
                displayCart();
                
                // إضافة تأثير بصري عند التغيير
                const updatedCard = document.querySelector(`[data-product-id="${productId}"]`);
                if (updatedCard) {
                    updatedCard.style.transform = 'scale(0.95)';
                    setTimeout(() => updatedCard.style.transform = 'scale(1)', 150);
                }
            }
        }
        
        // حذف منتج من السلة
        function removeItem(productId) {
            const removedItem = cart.find(item => item.id === productId);
            cart = cart.filter(item => item.id !== productId);
            localStorage.setItem('emirates-gifts-cart', JSON.stringify(cart));
            displayCart();
            
            // إظهار رسالة حذف محسّنة
            const toast = document.createElement('div');
            toast.className = 'delete-notification';
            toast.innerHTML = `
                <div class="notification-content">
                    <div class="delete-icon">🗑️</div>
                    <div class="notification-text">
                        <strong>تم الحذف بنجاح</strong>
                        <p>“${removedItem ? removedItem.title : 'المنتج'}” حُذِف من السلة</p>
                    </div>
                </div>
            `;
            
            toast.style.cssText = `
                position: fixed; top: 20px; right: 20px; 
                background: linear-gradient(135deg, #e74c3c, #c0392b); color: white;
                padding: 15px 20px; border-radius: 12px; z-index: 1000;
                font-weight: 600; opacity: 0; transition: opacity 0.3s ease;
                box-shadow: 0 6px 20px rgba(231, 76, 60, 0.3);
            `;
            
            document.body.appendChild(toast);
            setTimeout(() => toast.style.opacity = '1', 100);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }
        
        // عرض محتويات السلة مع التقييمات المحسّنة
        function displayCart() {
            const cartContent = document.getElementById('cart-content');
            
            if (cart.length === 0) {
                cartContent.innerHTML = `
                    <div class="empty-cart">
                        <div class="empty-cart-icon">🛍</div>
                        <h2>سلة التسوق فارغة</h2>
                        <p>لا توجد منتجات في سلتك حالياً من متجر هدايا الإمارات</p>
                        <a href="./" class="btn-continue">
                            🛍 ابدأ التسوق الآن
                        </a>
                        <a href="./products-showcase.html" class="btn-continue" style="margin-top: 15px;">
                            🎁 عرض جميع المنتجات
                        </a>
                    </div>
                `;
                return;
            }
            
            const total = cart.reduce((sum, item) => {
                const price = parseFloat(item.sale_price || item.price || '0');
                return sum + (price * item.quantity);
            }, 0);
            
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            
            let cartHTML = '<div class="cart-items">';
            
            cart.forEach(item => {
                const itemPrice = parseFloat(item.sale_price || item.price || '0');
                const itemTotal = itemPrice * item.quantity;
                
                // عرض تقييم المنتج إذا كان متوفر
                const ratingHTML = item.rating ? `
                    <div class="item-rating">
                        <span class="stars">${'★'.repeat(Math.floor(item.rating.rating))}</span>
                        <span class="rating-number">${item.rating.rating.toFixed(1)}</span>
                        <span class="reviews-count">(${item.rating.count})</span>
                        <span class="professional-note">✓ ${item.rating.professionalReview || 'منتج مميز'}</span>
                    </div>
                ` : '';
                
                cartHTML += `
                    <div class="cart-item" data-product-id="${item.id}">
                        <img src="${item.image_link || item.image}" alt="${item.title}" loading="lazy" decoding="async">
                        <div class="item-details">
                            <div class="item-title">${item.title}</div>
                            ${ratingHTML}
                            <div class="item-price">${itemPrice.toFixed(2)} د.إ x ${item.quantity}</div>
                            <div class="item-store">من: متجر هدايا الإمارات</div>
                            ${item.addedAt ? `<small style="color: #999; font-size: 0.8rem;">أضيف في: ${new Date(item.addedAt).toLocaleDateString('ar-AE')}</small>` : ''}
                        </div>
                        <div class="quantity-controls">
                            <button class="quantity-btn" onclick="updateQuantity('${item.id}', -1)" aria-label="تقليل الكمية">-</button>
                            <span class="quantity-display">${item.quantity}</span>
                            <button class="quantity-btn" onclick="updateQuantity('${item.id}', 1)" aria-label="زيادة الكمية">+</button>
                        </div>
                        <button class="remove-item" onclick="removeItem('${item.id}')" aria-label="حذف المنتج">
                            🗑️ حذف
                        </button>
                    </div>
                `;
            });
            
            cartHTML += '</div>';
            
            // ملخص الطلب المحسّن
            cartHTML += `
                <div class="cart-summary">
                    <div class="summary-header">
                        <h3>📊 ملخص الطلب</h3>
                    </div>
                    <div class="summary-row">
                        <span>عدد المنتجات:</span>
                        <span>${totalItems} قطعة</span>
                    </div>
                    <div class="summary-row">
                        <span>إجمالي المنتجات:</span>
                        <span>${total.toFixed(2)} د.إ</span>
                    </div>
                    <div class="summary-row">
                        <span>رسوم الشحن:</span>
                        <span style="color: #27ae60; font-weight: bold;">مجاني ✓</span>
                    </div>
                    <div class="summary-row summary-total">
                        <span>الإجمالي النهائي:</span>
                        <span>${total.toFixed(2)} د.إ</span>
                    </div>
                    
                    <div class="delivery-info" style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px; font-size: 0.9rem;">
                        🚚 <strong>التوصيل:</strong> مجاني في جميع إمارات الدولة<br>
                        ⏰ <strong>وقت التوصيل:</strong> 24-48 ساعة<br>
                        ✅ <strong>ضمان الجودة:</strong> منتجات أصلية 100%
                    </div>
                    
                    <div class="checkout-actions">
                        <a href="${createWhatsAppOrderLink()}" class="btn-checkout" target="_blank">
                            📱 إتمام الطلب عبر واتساب
                        </a>
                        <a href="./products-showcase.html" class="btn-continue">
                            🛍 متابعة التسوق
                        </a>
                    </div>
                </div>
            `;
            
            cartContent.innerHTML = cartHTML;
            
            // تفعيل الانيميشن لبطاقات السلة
            setTimeout(() => {
                document.querySelectorAll('.cart-item').forEach((item, index) => {
                    item.style.opacity = '0';
                    item.style.transform = 'translateX(50px)';
                    setTimeout(() => {
                        item.style.opacity = '1';
                        item.style.transform = 'translateX(0)';
                    }, index * 100);
                });
            }, 100);
        }
        
        // إنشاء رابط واتساب للطلب مع التقييمات
        function createWhatsAppOrderLink() {
            if (cart.length === 0) return '#';
            
            let message = `مرحباً! أريد إتمام طلب من متجر هدايا الإمارات:

`;
            
            let total = 0;
            cart.forEach((item, index) => {
                const itemPrice = parseFloat(item.sale_price || item.price || '0');
                const itemTotal = itemPrice * item.quantity;
                total += itemTotal;
                
                message += `${index + 1}. ${item.title}
`;
                if (item.rating) {
                    message += `   ⭐ تقييم: ${item.rating.rating.toFixed(1)} (${item.rating.count} مراجعة)
`;
                    if (item.rating.professionalReview) {
                        message += `   ✓ ${item.rating.professionalReview}
`;
                    }
                }
                message += `   الكمية: ${item.quantity}
`;
                message += `   السعر: ${itemPrice.toFixed(2)} د.إ
`;
                message += `   الإجمالي: ${itemTotal.toFixed(2)} د.إ

`;
            });
            
            message += `💰 إجمالي الطلب: ${total.toFixed(2)} د.إ
`;
            message += `🚚 الشحن: مجاني في جميع إمارات الدولة

`;
            message += 'يرجى تأكيد الطلب وإرسال تفاصيل التوصيل لإتمام عملية الشراء.';
            
            return `https://wa.me/201110760081?text=${encodeURIComponent(message)}`;
        }
        
        // تحديث شريط التقدم
        const updateScrollProgress = () => {
            const scrollTop = window.pageYOffset;
            const docHeight = document.documentElement.scrollHeight;
            const winHeight = window.innerHeight;
            const scrollPercent = scrollTop / (docHeight - winHeight);
            if (scrollProgress) {
                scrollProgress.style.width = `${scrollPercent * 100}%`;
            }
        };
        
        // ربط أحداث التمرير
        let scrollTimeout;
        window.addEventListener('scroll', () => {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(updateScrollProgress, 16);
        }, { passive: true });
        
        // زر العودة للأعلى
        const backToTopBtn = document.getElementById('back-to-top');
        if (backToTopBtn) {
            window.addEventListener('scroll', () => {
                if (window.pageYOffset > 300) {
                    backToTopBtn.classList.add('show');
                } else {
                    backToTopBtn.classList.remove('show');
                }
            }, { passive: true });
            
            backToTopBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }
        
        // جعل الوظائف عامة
        window.updateQuantity = updateQuantity;
        window.removeItem = removeItem;
        window.createWhatsAppOrderLink = createWhatsAppOrderLink;
        
        // عرض السلة عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🛍 تم تحميل صفحة سلة التسوق بنجاح');
            displayCart();
            
            // إضافة Google Analytics إذا كان متاح
            if (typeof gtag !== 'undefined') {
                gtag('event', 'page_view', {
                    'page_title': 'سلة التسوق - متجر هدايا الإمارات',
                    'cart_items': cart.length
                });
            }
        });
    </script>
    
    <!-- JSON-LD لصفحة السلة -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "سلة التسوق - متجر هدايا الإمارات",
        "description": "عرض وإدارة منتجات العطور والساعات مع عرض التقييمات",
        "url": "https://emirates-gifts.arabsad.com/cart.html",
        "isPartOf": {
            "@type": "WebSite",
            "name": "متجر هدايا الإمارات",
            "url": "https://emirates-gifts.arabsad.com"
        }
    }
    </script>
</body>
</html>
!function(){"use strict";let e,t,n,o,a,s;function i(e){const t=document.getElementById(e);return t||console.warn("⚠️ العنصر غير موجود: "+e),t}function l(e,t,n){if(e)try{n?!e.classList.contains(t)&&e.classList.add(t):e.classList.contains(t)&&e.classList.remove(t)}catch(o){console.warn("⚠️ خطأ في إدارة الكلاس "+t+":",o)}}function r(){e=i("backToTop")||i("back-to-top"),t=i("header"),n=i("progressBar"),o=i("openSidebar"),a=i("mobileSidebar"),s=i("mobileOverlay")}const c=()=>{try{const o=window.pageYOffset||document.documentElement.scrollTop||0;l(e,"show",o>300),l(t,"scrolled",o>100);if(n){const e=window.innerHeight,t=document.documentElement.scrollHeight,a=o/(t-e),s=Math.min(Math.max(100*a,0),100);n.style.width=s+"%"}}catch(e){console.warn("⚠️ خطأ في دالة التمرير:",e)}},d=()=>{try{window.scrollTo({top:0,behavior:"smooth"})}catch{window.scrollTo(0,0)}};function u(e){try{l(a,"show",e),l(s,"show",e),l(document.body,"menu-open",e)}catch(t){console.warn("⚠️ خطأ في إدارة القائمة الجانبية:",t)}}function m(){window.addEventListener("scroll",c,{passive:!0}),e&&e.addEventListener("click",d),o&&o.addEventListener("click",(()=>u(!0)));const t=i("closeSidebar");t&&t.addEventListener("click",(()=>u(!1))),s&&s.addEventListener("click",(()=>u(!1)))}function f(){try{r(),m(),c(),console.log("✅ تم تهيئة واجهة المستخدم بنجاح")}catch(e){console.error("❌ خطأ في تهيئة واجهة المستخدم:",e)}}window.persistentReviews={reviewsData:null,isInitialized:!1,async loadReviewsData(){try{const e=await fetch("./data/reviews.json?t="+Date.now());if(!e.ok)throw new Error("Failed to load reviews data");return this.reviewsData=await e.json(),!0}catch(e){return this.reviewsData=[],!1}},getProductReviews(e){return this.reviewsData?this.reviewsData.find((t=>t.productId===e.toString())):null},createSummaryHTML(e){const t=this.getProductReviews(e);if(!t||!t.reviews?.length)return'<div class="rating-summary-minimal"><div class="stars">⭐⭐⭐⭐⭐</div><span class="rating-text">منتج عالي الجودة</span></div>';const{averageRating:n,totalCount:o,reviews:a}=t,s=Math.floor(n),i=n%1>=.5,l="⭐".repeat(s)+(i?"⭐":""),r=a.filter((e=>e.verified)).length,c=a.slice(0,2);return`<div class="emirates-rating-summary"><div class="main-rating"><div class="stars-display">${l}</div><div class="rating-number">${n}</div><div class="rating-label">من 5 نجوم</div></div><div class="rating-stats"><div class="stat-item"><i class="fas fa-users"></i><span>${o} تقييم</span></div><div class="stat-item verified"><i class="fas fa-shield-check"></i><span>${r} موثّق</span></div></div><div class="recent-reviews">${c.map((e=>`<div class="mini-review"><div class="review-author">${e.author} ${e.verified?"✅":""} ${e.location?`(${e.location})`:""}</div><div class="review-stars">${"⭐".repeat(e.rating)}</div><div class="review-comment">${e.comment}</div></div>`)).join("")}</div></div>`},async init(){const e=await this.loadReviewsData();e&&(setTimeout((()=>this.addReviewsToCards()),1e3),this.setupObserver(),this.isInitialized=!0)},addReviewsToCards(){this.reviewsData&&document.querySelectorAll(".product-card").forEach((e=>{const t=e.querySelector(".product-title, h3, .card-title");if(t&&!e.querySelector(".card-rating")){const n=e.getAttribute("data-id")||t.getAttribute("data-id")||this.extractIdFromCard(e);if(n){const e=this.getProductReviews(n);e&&(t.insertAdjacentHTML("afterend",this.createCardRatingHTML(e.averageRating,e.totalCount)))}}}))},extractIdFromCard(e){const t=e.querySelector('a[href*="id="]');if(t){const e=t.getAttribute("href").match(/id=([^&]+)/);if(e)return e[1]}return this.guessProductId(e.querySelector(".product-title, h3")?.textContent||"")},guessProductId(e){const t=e.toLowerCase();return t.includes("كوكو شانيل")?"perfume_1":t.includes("جوتشي فلورا")?"perfume_2":t.includes("جوتشي بلوم")?"perfume_3":t.includes("رولكس يخت ماستر")?"watch_1":null},createCardRatingHTML(e,t){return`<div class="card-rating emirates-style"><div class="stars">${"⭐".repeat(Math.floor(e))}</div><div class="rating-info"><span class="rating-number">${e}</span><span class="reviews-count">(${t})</span></div></div>`},setupObserver(){new MutationObserver((()=>{this.addReviewsToCards()})).observe(document.body,{childList:!0,subtree:!0})}};window.EmiratesPopupSystem={isActive:!0,interval:null,lastShown:0,DISPLAY_INTERVAL:2e4,STORAGE_KEY:"emirates_popup_dismissed",showPopup(){if(document.querySelector("#emirates-popup"))return;const e=Date.now();if(e-this.lastShown<this.DISPLAY_INTERVAL)return;if("true"===localStorage.getItem(this.STORAGE_KEY))return;const t=this.createPopup();document.body.appendChild(t),setTimeout((()=>{t.classList.add("show")}),100),this.lastShown=e,setTimeout((()=>{this.hidePopup()}),1e4)},createPopup(){const e=document.createElement("div");return e.id="emirates-popup",e.className="emirates-popup",e.innerHTML='<div class="popup-overlay"></div><div class="popup-container"><button class="popup-close" onclick="EmiratesPopupSystem.dismissPopup()"><i class="fas fa-times"></i></button><div class="popup-content"><div class="popup-icon">🎁</div><h3 class="popup-title">عروض حصرية لفترة محدودة!</h3><p class="popup-message">احصل على خصم <strong>15%</strong> على جميع العطور عالية الجودة<br><small>✨ توصيل مجاني خلال 1-3 أيام عمل</small></p><div class="popup-actions"><a href="./products-showcase.html" class="popup-btn primary"><i class="fas fa-shopping-bag"></i>تسوق الآن</a><a href="https://wa.me/201110760081?text=مرحباً! أريد الاستفادة من العرض الحصري 15%" class="popup-btn secondary" target="_blank"><i class="fab fa-whatsapp"></i>واتساب</a></div></div></div>',e},hidePopup(){const e=document.querySelector("#emirates-popup");e&&(e.classList.remove("show"),setTimeout((()=>{e.remove()}),400))},dismissPopup(){this.hidePopup(),localStorage.setItem(this.STORAGE_KEY,"true"),setTimeout((()=>{localStorage.removeItem(this.STORAGE_KEY)}),36e5)},start(){this.isActive&&(setTimeout((()=>{this.showPopup()}),this.DISPLAY_INTERVAL),this.interval=setInterval((()=>{this.showPopup()}),this.DISPLAY_INTERVAL))},init(){window.addEventListener("load",(()=>{setTimeout((()=>{this.start()}),2e3)}))}};function p(){const e=JSON.parse(localStorage.getItem("emirates_shopping_cart")||"[]");h(e.length)}function h(e){document.querySelectorAll(".cart-counter").forEach((t=>{t.textContent=e,t.style.display=e>0?"flex":"none"}))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",(()=>{f(),window.persistentReviews.init(),EmiratesPopupSystem.init(),p()})):(f(),window.persistentReviews.init(),EmiratesPopupSystem.init(),p());}();
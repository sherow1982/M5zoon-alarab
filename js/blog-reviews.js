// ูุธุงู ุชูููู ุงูููุงูุงุช ูุงููุฏููุฉ - ูุชุฌุฑ ูุฏุงูุง ุงูุฅูุงุฑุงุช

// ุจูุงูุงุช ุชููููุงุช ุงูููุงูุงุช ุงูุงุญุชุฑุงููุฉ
const blogArticleReviews = {
    // ููุงูุงุช ุฏูุงุฆู ุงูุนุทูุฑ
    'perfume-guide-2025': { rating: 4.9, count: 234, professionalReview: 'ุฏููู ุดุงูู ููุญุฏูุซ ูุนุงูู ุงูุนุทูุฑ' },
    'tom-ford-collection': { rating: 4.8, count: 189, professionalReview: 'ุชุญููู ุนููู ููุฌููุนุฉ ุชูู ููุฑุฏ' },
    'arabic-perfumes-heritage': { rating: 4.9, count: 278, professionalReview: 'ุฏููู ุงูุนุทูุฑ ุงูุนุฑุจูุฉ ุงูุชุฑุงุซูุฉ' },
    'luxury-fragrances-uae': { rating: 4.8, count: 167, professionalReview: 'ุฏููู ุงูุนุทูุฑ ุงููุงุฎุฑุฉ ูู ุงูุฅูุงุฑุงุช' },
    'fragrance-layering-tips': { rating: 4.7, count: 145, professionalReview: 'ุชูููุงุช ุงุญุชุฑุงููุฉ ูุงุณุชุฎุฏุงู ุงูุนุทูุฑ' },
    
    // ููุงูุงุช ุฏูุงุฆู ุงูุณุงุนุงุช
    'watches-buying-guide': { rating: 4.8, count: 198, professionalReview: 'ุฏููู ุดุฑุงุก ุงูุณุงุนุงุช ุงูุดุงูู' },
    'rolex-collection-2025': { rating: 4.9, count: 312, professionalReview: 'ุฏููู ูุฌููุนุฉ ุฑูููุณ ุงูุฌุฏูุฏุฉ' },
    'luxury-watches-care': { rating: 4.7, count: 156, professionalReview: 'ูุตุงุฆุญ ูููุฉ ููุนูุงูุฉ ุจุงูุณุงุนุงุช' },
    'omega-vs-rolex': { rating: 4.8, count: 223, professionalReview: 'ููุงุฑูุฉ ุงุญุชุฑุงููุฉ ุจูู ุงูุนูุงูุชูู' },
    'watch-investment-guide': { rating: 4.6, count: 134, professionalReview: 'ุฏููู ุงูุงุณุชุซูุงุฑ ูู ุงูุณุงุนุงุช' },
    
    // ููุงูุงุช ุงููุฏุงูุง ูุงูุชุณูู
    'luxury-gifts-guide': { rating: 4.8, count: 178, professionalReview: 'ุฏููู ุงููุฏุงูุง ุงููุงุฎุฑุฉ ุงูุดุงูู' },
    'uae-shopping-tips': { rating: 4.7, count: 156, professionalReview: 'ูุตุงุฆุญ ุฐูุจูุฉ ููุชุณูู ูู ุงูุฅูุงุฑุงุช' },
    'gift-wrapping-ideas': { rating: 4.6, count: 123, professionalReview: 'ุฃููุงุฑ ุฅุจุฏุงุนูุฉ ูุชุบููู ุงููุฏุงูุง' },
    'seasonal-perfumes': { rating: 4.8, count: 201, professionalReview: 'ุฏููู ุงูุนุทูุฑ ุงูููุณููุฉ' },
    'celebrity-fragrances': { rating: 4.7, count: 167, professionalReview: 'ุนุทูุฑ ุงููุดุงููุฑ ููุตุต ูุฌุงุญูุง' },
    'watch-collecting-basics': { rating: 4.9, count: 245, professionalReview: 'ุฏููู ุฌูุน ุงูุณุงุนุงุช ูููุจุชุฏุฆูู' }
};

// ุฏุงูุฉ ุงูุญุตูู ุนูู ุชูููู ุงูููุงู
function getBlogArticleRating(articleSlug) {
    // ุงูุจุญุซ ุนู ุงูููุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
    if (blogArticleReviews[articleSlug]) {
        return blogArticleReviews[articleSlug];
    }
    
    // ุงูุจุญุซ ุจุงููููุงุช ุงูููุชุงุญูุฉ
    const slug = articleSlug.toLowerCase();
    for (let key in blogArticleReviews) {
        if (slug.includes(key.split('-')[0]) || key.includes(slug)) {
            return blogArticleReviews[key];
        }
    }
    
    // ุชูููู ุงูุชุฑุงุถู ุนุงูู
    return {
        rating: 4.5 + Math.random() * 0.4,
        count: Math.floor(Math.random() * 150 + 50),
        professionalReview: 'ููุงู ูููุฏ ูููุชูุจ ุจุฅุชูุงู ุนุงูู'
    };
}

// ุฏุงูุฉ ุฅูุดุงุก HTML ูุชูููู ุงูููุงู (ุจุทุงูุฉ ูุจุณุทุฉ)
function createBlogCardRating(ratingData) {
    const stars = 'โ'.repeat(Math.floor(ratingData.rating));
    
    return `
        <div class="blog-card-rating">
            <span class="stars">${stars}</span>
            <span class="rating-number">${ratingData.rating.toFixed(1)}</span>
            <span class="reviews-count">(${ratingData.count})</span>
        </div>
    `;
}

// ุฏุงูุฉ ุฅูุดุงุก HTML ูุชูููู ุงูููุงู (ุตูุญุฉ ูุงููุฉ)
function createFullArticleRating(ratingData) {
    const fullStars = Math.floor(ratingData.rating);
    const hasHalfStar = ratingData.rating % 1 >= 0.5;
    const stars = 'โ'.repeat(fullStars) + (hasHalfStar ? 'โ' : '');
    
    return `
        <div class="article-professional-rating">
            <div class="rating-header">
                <div class="main-rating">
                    <span class="rating-stars">${stars}</span>
                    <span class="rating-number">${ratingData.rating.toFixed(1)}</span>
                </div>
                <div class="rating-info">
                    <p class="reviews-count">${ratingData.count} ูุงุฑุฆ ูููู ุงูููุงู</p>
                    <p class="professional-review">โ ${ratingData.professionalReview}</p>
                </div>
            </div>
            
            <div class="reader-feedback">
                <h4>ุขุฑุงุก ุงููุฑุงุก:</h4>
                <div class="feedback-item">
                    <div class="reader-info">
                        <strong>ูุญูุฏ ุฃ.</strong>
                        <span class="review-stars">โโโโโ</span>
                    </div>
                    <p>"ููุงู ูููุฏ ุฌุฏุงู ููุนูููุงุช ููููุฉ"</p>
                    <small>ููุฐ ููููู</small>
                </div>
                <div class="feedback-item">
                    <div class="reader-info">
                        <strong>ููุฑู ุณ.</strong>
                        <span class="review-stars">โโโโโ</span>
                    </div>
                    <p>"ุดุฑุญ ุฑุงุฆุน ููุนูููุงุช ูููุฏุฉ ููุบุงูุฉ"</p>
                    <small>ููุฐ ุฃุณุจูุน</small>
                </div>
                <div class="feedback-item">
                    <div class="reader-info">
                        <strong>ุฎุงูุฏ ู.</strong>
                        <span class="review-stars">โโโโโ</span>
                    </div>
                    <p>"ููุงู ููุชุงุฒ ููุฑุฌุน ูููุฏ"</p>
                    <small>ููุฐ ุฃุณุจูุนูู</small>
                </div>
            </div>
            
            <div class="rating-call-to-action">
                <p style="margin-bottom: 15px; color: #666; font-size: 14px;">ูู ูุฌุฏุช ูุฐุง ุงูููุงู ูููุฏุงูุ</p>
                <div class="rating-buttons">
                    <button class="rate-btn positive" onclick="rateArticle('positive')">
                        ๐ ูุนูุ ูููุฏ
                    </button>
                    <button class="rate-btn neutral" onclick="rateArticle('neutral')">
                        ๐ ุนุงุฏู
                    </button>
                    <button class="rate-btn negative" onclick="rateArticle('negative')">
                        ๐ ูุญุชุงุฌ ุชุญุณูู
                    </button>
                </div>
            </div>
        </div>
    `;
}

// ุฏุงูุฉ ุฅุถุงูุฉ ุงูุชููููุงุช ูุจุทุงูุงุช ุงูููุงูุงุช
function addBlogCardReviews() {
    const blogCards = document.querySelectorAll('.blog-card, .article-card, .post-card');
    
    blogCards.forEach(card => {
        // ุงูุจุญุซ ุนู ุนููุงู ุงูููุงู
        const titleElement = card.querySelector('h2, h3, .article-title, .post-title');
        const linkElement = card.querySelector('a[href*=".html"], a[href*="/blog/"]');
        
        if (titleElement && !card.querySelector('.blog-card-rating')) {
            let articleSlug = '';
            
            // ูุญุงููุฉ ุงุณุชุฎุฑุงุฌ slug ูู ุงูุฑุงุจุท
            if (linkElement) {
                const href = linkElement.getAttribute('href');
                const pathParts = href.split('/');
                articleSlug = pathParts[pathParts.length - 1].replace('.html', '');
            } else {
                // ุฅูุดุงุก slug ูู ุงูุนููุงู
                articleSlug = titleElement.textContent.trim()
                    .toLowerCase()
                    .replace(/\s+/g, '-')
                    .replace(/[^\u0600-\u06FF\w\s-]/g, '')
                    .replace(/-+/g, '-');
            }
            
            const ratingData = getBlogArticleRating(articleSlug);
            const ratingHTML = createBlogCardRating(ratingData);
            
            // ุฅุฏุฑุงุฌ ุงูุชูููู ุจุนุฏ ุงูุนููุงู
            titleElement.insertAdjacentHTML('afterend', ratingHTML);
        }
    });
}

// ุฏุงูุฉ ุฅุถุงูุฉ ุชูููู ูุงูู ูุตูุญุฉ ุงูููุงู
function addFullArticleRating(articleSlug) {
    const ratingData = getBlogArticleRating(articleSlug);
    const ratingHTML = createFullArticleRating(ratingData);
    
    // ุงูุจุญุซ ุนู ููุงู ุฅุฏุฑุงุฌ ุงูุชูููู
    const articleContent = document.querySelector('.article-content, .post-content, main article');
    const insertTarget = articleContent ? articleContent : document.querySelector('.container');
    
    if (insertTarget && !document.querySelector('.article-professional-rating')) {
        insertTarget.insertAdjacentHTML('beforeend', ratingHTML);
    }
}

// ุฏุงูุฉ ุชูููู ุงูููุงู (ุชูุงุนููุฉ)
function rateArticle(rating) {
    const buttons = document.querySelectorAll('.rate-btn');
    const clickedButton = event.target;
    
    // ุชุบููุฑ ุญุงูุฉ ุงูุฃุฒุฑุงุฑ
    buttons.forEach(btn => btn.classList.remove('selected'));
    clickedButton.classList.add('selected');
    
    // ุญูุธ ุงูุชูููู ูุญููุงู
    const articleUrl = window.location.pathname;
    localStorage.setItem(`article-rating-${articleUrl}`, rating);
    
    // ุนุฑุถ ุฑุณุงูุฉ ุดูุฑ
    const thankYouMessage = document.createElement('div');
    thankYouMessage.className = 'rating-thank-you';
    thankYouMessage.innerHTML = `
        <div class="thank-you-content">
            <span class="thank-you-icon">โค๏ธ</span>
            <span>ุดูุฑุงู ูุชููููู!</span>
        </div>
    `;
    
    clickedButton.parentNode.appendChild(thankYouMessage);
    
    // ุฅุฎูุงุก ุงูุฃุฒุฑุงุฑ ุจุนุฏ ุงูุชูููู
    setTimeout(() => {
        buttons.forEach(btn => btn.style.display = 'none');
    }, 2000);
}

// ุฏุงูุฉ ุจุญุซ ูุฅุถุงูุฉ ุงูุชููููุงุช ุชููุงุฆูุงู
function autoAddBlogReviews() {
    // ุฅุถุงูุฉ ุชููููุงุช ูุจุทุงูุงุช ุงูููุงูุงุช
    addBlogCardReviews();
    
    // ุฅุถุงูุฉ ุชูููู ูุตูุญุฉ ููุงู ููุฑุฏุฉ (ุฅุฐุง ูุงูุช ููุฌูุฏุฉ)
    if (window.location.pathname.includes('/blog/') || window.location.pathname.includes('article')) {
        const articleSlug = window.location.pathname.split('/').pop().replace('.html', '');
        addFullArticleRating(articleSlug);
    }
}

// ุฅุถุงูุฉ CSS ููุชููููุงุช
function addBlogReviewsCSS() {
    if (!document.querySelector('#blog-reviews-css')) {
        const css = `
            <style id="blog-reviews-css">
            .blog-card-rating {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                margin: 12px 0;
                padding: 10px;
                background: rgba(39, 174, 96, 0.1);
                border-radius: 10px;
                border: 1px solid rgba(39, 174, 96, 0.2);
            }
            
            .blog-card-rating .stars {
                color: #FFD700;
                font-size: 16px;
                text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            }
            
            .blog-card-rating .rating-number {
                font-weight: bold;
                color: #2c3e50;
                font-size: 15px;
            }
            
            .blog-card-rating .reviews-count {
                color: #666;
                font-size: 12px;
            }
            
            .article-professional-rating {
                margin: 30px 0;
                padding: 25px;
                background: linear-gradient(135deg, #f8f9fa, #ffffff);
                border-radius: 15px;
                border: 2px solid rgba(39, 174, 96, 0.1);
                box-shadow: 0 6px 20px rgba(0,0,0,0.06);
            }
            
            .rating-header {
                display: flex;
                align-items: center;
                gap: 20px;
                margin-bottom: 25px;
                padding-bottom: 20px;
                border-bottom: 1px solid #e9ecef;
            }
            
            .main-rating {
                text-align: center;
                min-width: 100px;
            }
            
            .rating-header .rating-stars {
                color: #FFD700;
                font-size: 32px;
                text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
                display: block;
                margin-bottom: 8px;
                letter-spacing: 3px;
            }
            
            .rating-header .rating-number {
                font-size: 28px;
                font-weight: bold;
                color: #2c3e50;
            }
            
            .rating-info .reviews-count {
                color: #666;
                font-size: 16px;
                margin-bottom: 10px;
                display: block;
            }
            
            .rating-info .professional-review {
                color: #27ae60;
                font-weight: 600;
                font-size: 15px;
                margin: 0;
                line-height: 1.4;
            }
            
            .reader-feedback {
                margin-top: 25px;
            }
            
            .reader-feedback h4 {
                color: #2c3e50;
                margin-bottom: 20px;
                font-size: 18px;
                border-bottom: 2px solid #27ae60;
                padding-bottom: 8px;
                display: inline-block;
            }
            
            .feedback-item {
                background: white;
                padding: 15px;
                border-radius: 10px;
                margin-bottom: 12px;
                border-right: 4px solid #27ae60;
                box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            }
            
            .reader-info {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 8px;
            }
            
            .reader-info strong {
                color: #2c3e50;
                font-size: 15px;
            }
            
            .review-stars {
                color: #FFD700;
                font-size: 14px;
            }
            
            .feedback-item p {
                color: #555;
                margin: 8px 0;
                line-height: 1.6;
                font-style: italic;
            }
            
            .feedback-item small {
                color: #999;
                font-size: 12px;
            }
            
            .rating-call-to-action {
                text-align: center;
                margin-top: 25px;
                padding: 20px;
                background: rgba(39, 174, 96, 0.05);
                border-radius: 10px;
            }
            
            .rating-buttons {
                display: flex;
                gap: 10px;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .rate-btn {
                padding: 10px 20px;
                border: 2px solid #27ae60;
                background: white;
                color: #27ae60;
                border-radius: 25px;
                cursor: pointer;
                font-weight: 600;
                transition: all 0.3s ease;
                font-size: 14px;
            }
            
            .rate-btn:hover {
                background: #27ae60;
                color: white;
                transform: translateY(-2px);
            }
            
            .rate-btn.selected {
                background: #27ae60;
                color: white;
            }
            
            .rate-btn.positive.selected {
                background: #27ae60;
            }
            
            .rate-btn.neutral.selected {
                background: #f39c12;
                border-color: #f39c12;
            }
            
            .rate-btn.negative.selected {
                background: #e74c3c;
                border-color: #e74c3c;
            }
            
            .rating-thank-you {
                margin-top: 15px;
                padding: 10px;
                background: #27ae60;
                color: white;
                border-radius: 8px;
                font-weight: 600;
                animation: fadeInScale 0.5s ease;
            }
            
            .thank-you-content {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
            }
            
            @keyframes fadeInScale {
                from {
                    opacity: 0;
                    transform: scale(0.8);
                }
                to {
                    opacity: 1;
                    transform: scale(1);
                }
            }
            
            @media (max-width: 768px) {
                .rating-header {
                    flex-direction: column;
                    text-align: center;
                    gap: 15px;
                }
                
                .rating-header .rating-stars {
                    font-size: 28px;
                }
                
                .rating-header .rating-number {
                    font-size: 24px;
                }
                
                .reader-info {
                    flex-direction: column;
                    gap: 5px;
                    text-align: center;
                }
                
                .rating-buttons {
                    flex-direction: column;
                    align-items: center;
                }
                
                .rate-btn {
                    width: 200px;
                }
            }
            </style>
        `;
        document.head.insertAdjacentHTML('beforeend', css);
    }
}

// ุชุดุบูู ูุธุงู ุชูููู ุงููุฏููุฉ
function initBlogReviews() {
    addBlogReviewsCSS();
    
    // ุฅุถุงูุฉ ุงูุชููููุงุช ููุจุทุงูุงุช ุจุนุฏ ุชุญููู ุงููุญุชูู
    setTimeout(() => {
        autoAddBlogReviews();
    }, 1500);
    
    // ูุฑุงูุจ ุงูุชุบููุฑุงุช ูุฅุถุงูุฉ ุงูุชููููุงุช ูููุญุชูู ุงูุฌุฏูุฏ
    const observer = new MutationObserver(() => {
        autoAddBlogReviews();
    });
    
    observer.observe(document.body, {
        childList: true,
        subtree: true
    });
}

// ุชุดุบูู ุนูุฏ ุงูุชุญููู
document.addEventListener('DOMContentLoaded', initBlogReviews);

// ุชุตุฏูุฑ ุงููุธุงู
window.BlogReviews = {
    blogArticleReviews,
    getBlogArticleRating,
    createBlogCardRating,
    createFullArticleRating,
    addBlogCardReviews,
    addFullArticleRating,
    rateArticle,
    autoAddBlogReviews,
    initBlogReviews
};
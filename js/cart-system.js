// ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ≥ŸÑÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸëŸÜ ŸàÿßŸÑŸÖŸèÿµÿ≠ÿ≠ - ŸÖÿ™ÿ¨ÿ± ŸáÿØÿßŸäÿß ÿßŸÑÿ•ŸÖÿßÿ±ÿßÿ™
// ÿ•ÿµŸÑÿßÿ≠ ŸÖÿ¥ÿßŸÉŸÑ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸàÿßŸÑÿ™ŸÜŸÇŸÑ ŸÑŸÑÿ≥ŸÑÿ©

(function(){
    'use strict';
    
    const CART_STORAGE_KEY = 'emirates_shopping_cart';
    
    // ÿØÿßŸÑÿ© ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÜÿ™ÿ¨ ŸÑŸÑÿ≥ŸÑÿ© - ŸÖŸèÿ≠ÿ≥ŸÜÿ© ŸàŸÖŸèÿµÿ≠ÿ≠ÿ©
    function addToCartSafe(productData) {
        try {
            console.log('üîÑ ŸÖÿ≠ÿßŸàŸÑÿ© ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÜÿ™ÿ¨ ŸÑŸÑÿ≥ŸÑÿ©:', productData);
            
            // ÿ™ŸÜÿ∏ŸäŸÅ Ÿàÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸÜÿ™ÿ¨
            if (!productData) {
                console.error('‚ùå ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸÜÿ™ÿ¨ ŸÖŸÅŸÇŸàÿØÿ©');
                showErrorNotification('ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©');
                return false;
            }
            
            // ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ Ÿàÿ•ÿ∂ÿßŸÅÿ© ŸÇŸäŸÖ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
            const cleanProduct = {
                id: productData.id || Date.now().toString(),
                title: productData.title || productData.name || 'ŸÖŸÜÿ™ÿ¨ ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ',
                price: productData.price || productData.sale_price || '0',
                sale_price: productData.sale_price || productData.price || '0',
                image_link: productData.image_link || productData.image || 'https://via.placeholder.com/300x300/D4AF37/FFFFFF?text=ŸáÿØÿßŸäÿß+ÿßŸÑÿ•ŸÖÿßÿ±ÿßÿ™',
                quantity: 1,
                addedAt: new Date().toISOString(),
                store: 'ŸÖÿ™ÿ¨ÿ± ŸáÿØÿßŸäÿß ÿßŸÑÿ•ŸÖÿßÿ±ÿßÿ™'
            };
            
            console.log('‚úÖ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿßŸÑŸÖŸÜÿ∏ŸÅÿ©:', cleanProduct);
            
            // ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑÿ≥ŸÑÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©
            let cart = [];
            try {
                const cartData = localStorage.getItem(CART_STORAGE_KEY);
                cart = cartData ? JSON.parse(cartData) : [];
            } catch (e) {
                console.warn('‚ö†Ô∏è ÿÆÿ∑ÿ£ ŸÅŸä ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑÿ≥ŸÑÿ©ÿå ÿ•ŸÜÿ¥ÿßÿ° ÿ≥ŸÑÿ© ÿ¨ÿØŸäÿØÿ©:', e);
                cart = [];
            }
            
            // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑŸÖŸÜÿ™ÿ¨ ŸÅŸä ÿßŸÑÿ≥ŸÑÿ©
            const existingIndex = cart.findIndex(item => item.id === cleanProduct.id);
            
            if (existingIndex !== -1) {
                // ÿ≤ŸäÿßÿØÿ© ÿßŸÑŸÉŸÖŸäÿ© ŸÑŸÑŸÖŸÜÿ™ÿ¨ ÿßŸÑŸÖŸàÿ¨ŸàÿØ
                cart[existingIndex].quantity = (cart[existingIndex].quantity || 0) + 1;
                console.log('üìä ÿ™ŸÖ ÿ≤ŸäÿßÿØÿ© ŸÉŸÖŸäÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨:', cart[existingIndex]);
            } else {
                // ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÜÿ™ÿ¨ ÿ¨ÿØŸäÿØ
                cart.push(cleanProduct);
                console.log('üÜï ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÜÿ™ÿ¨ ÿ¨ÿØŸäÿØ ŸÑŸÑÿ≥ŸÑÿ©');
            }
            
            // ÿ≠ŸÅÿ∏ ÿßŸÑÿ≥ŸÑÿ©
            try {
                localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart));
                console.log('üíæ ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ≥ŸÑÿ© ÿ®ŸÜÿ¨ÿßÿ≠');
            } catch (e) {
                console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ≥ŸÑÿ©:', e);
                showErrorNotification('ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸÜÿ™ÿ¨');
                return false;
            }
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿπÿØÿßÿØ Ÿàÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©
            updateCartCounter();
            showSuccessNotification(cleanProduct.title);
            
            return true;
            
        } catch (error) {
            console.error('‚ùå ÿÆÿ∑ÿ£ ÿπÿßŸÖ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨:', error);
            showErrorNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÇÿπ. Ÿäÿ±ÿ¨Ÿâ ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ©.');
            return false;
        }
    }
    
    // ÿØÿßŸÑÿ© ÿ™ÿ≠ÿØŸäÿ´ ÿπÿØÿßÿØ ÿßŸÑÿ≥ŸÑÿ© - ŸÖÿ≠ÿ≥ŸëŸÜÿ©
    function updateCartCounter() {
        try {
            const cart = JSON.parse(localStorage.getItem(CART_STORAGE_KEY)) || [];
            const totalItems = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿ¨ŸÖŸäÿπ ÿßŸÑÿπÿØÿßÿØÿßÿ™
            const selectors = [
                '.cart-counter', '.cart-badge', '#cart-count', 
                '#cartBadge', '.mobile-cart-counter', '#currentCartCount'
            ];
            
            selectors.forEach(selector => {
                const elements = document.querySelectorAll(selector);
                elements.forEach(element => {
                    if (element) {
                        element.textContent = totalItems;
                        element.style.display = totalItems > 0 ? 'flex' : 'none';
                        
                        if (totalItems > 0) {
                            element.classList.add('has-items');
                        } else {
                            element.classList.remove('has-items');
                        }
                    }
                });
            });
            
            console.log(`üõí ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿπÿØÿßÿØ ÿßŸÑÿ≥ŸÑÿ©: ${totalItems} ŸÖŸÜÿ™ÿ¨`);
            
        } catch (error) {
            console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿπÿØÿßÿØ:', error);
        }
    }
    
    // ÿØÿßŸÑÿ© ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑŸÜÿ¨ÿßÿ≠ - ŸÖÿ≠ÿ≥ŸëŸÜÿ© ŸÖÿπ ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿ≥ŸÑÿ©
    function showSuccessNotification(productTitle) {
        // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©
        document.querySelectorAll('.success-notification, .error-notification').forEach(el => el.remove());
        
        const notification = document.createElement('div');
        notification.className = 'success-notification';
        notification.style.cssText = `
            position: fixed;
            top: 80px;
            right: 20px;
            background: linear-gradient(135deg, #25D366, #20B358);
            color: white;
            padding: 20px 25px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(37, 211, 102, 0.4);
            z-index: 10001;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            max-width: 380px;
            animation: slideInSuccess 0.5s ease-out;
            border: 2px solid rgba(255, 255, 255, 0.2);
            cursor: default;
        `;
        
        notification.innerHTML = `
            <div style="display: flex; align-items: flex-start; gap: 15px;">
                <div style="font-size: 2.2rem; animation: checkmark 0.6s ease-out; flex-shrink: 0;">‚úÖ</div>
                <div style="flex: 1;">
                    <div style="font-size: 1.1rem; margin-bottom: 5px; font-weight: 700;">ÿ™ŸÖ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ÿ®ŸÜÿ¨ÿßÿ≠!</div>
                    <div style="font-size: 0.9rem; opacity: 0.9; line-height: 1.4; margin-bottom: 10px;">
                        "${productTitle.length > 30 ? productTitle.substring(0, 30) + '...' : productTitle}" ÿ£Ÿèÿ∂ŸäŸÅ ÿ•ŸÑŸâ ÿßŸÑÿ≥ŸÑÿ©
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 12px;">
                        <button onclick="window.location.href='./cart.html'" 
                                style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 0.8rem; font-weight: 600; transition: all 0.3s;" 
                                onmouseover="this.style.background='rgba(255,255,255,0.3)'" 
                                onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                            üõçÔ∏è ÿπÿ±ÿ∂ ÿßŸÑÿ≥ŸÑÿ©
                        </button>
                        <button onclick="window.location.href='./checkout.html'" 
                                style="background: rgba(255,255,255,0.9); border: 1px solid rgba(255,255,255,1); color: #25D366; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 0.8rem; font-weight: 600; transition: all 0.3s;" 
                                onmouseover="this.style.background='white'" 
                                onmouseout="this.style.background='rgba(255,255,255,0.9)'">
                            üì± ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿ∑ŸÑÿ®
                        </button>
                    </div>
                </div>
                <button onclick="this.parentElement.parentElement.remove()" 
                        style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 1.2rem; cursor: pointer; padding: 0; margin: 0; line-height: 1; flex-shrink: 0;" 
                        title="ÿ•ÿ∫ŸÑÿßŸÇ">
                    √ó
                </button>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        // ÿ•ÿ≤ÿßŸÑÿ© ÿ™ŸÑŸÇÿßÿ¶Ÿäÿ© ÿ®ÿπÿØ 6 ÿ´ŸàÿßŸÜŸä
        setTimeout(() => {
            if (notification.parentNode) {
                notification.style.animation = 'slideOutSuccess 0.4s ease-in';
                setTimeout(() => notification.remove(), 400);
            }
        }, 6000);
        
        addNotificationStyles();
    }
    
    // ÿØÿßŸÑÿ© ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿÆÿ∑ÿ£ - ÿ¨ÿØŸäÿØÿ©
    function showErrorNotification(message) {
        // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©
        document.querySelectorAll('.success-notification, .error-notification').forEach(el => el.remove());
        
        const notification = document.createElement('div');
        notification.className = 'error-notification';
        notification.style.cssText = `
            position: fixed;
            top: 80px;
            right: 20px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 20px 25px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(231, 76, 60, 0.4);
            z-index: 10001;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            max-width: 350px;
            animation: slideInSuccess 0.5s ease-out;
            border: 2px solid rgba(255, 255, 255, 0.2);
        `;
        
        notification.innerHTML = `
            <div style="display: flex; align-items: flex-start; gap: 15px;">
                <div style="font-size: 2rem; flex-shrink: 0;">‚ùå</div>
                <div style="flex: 1;">
                    <div style="font-size: 1.1rem; margin-bottom: 5px; font-weight: 700;">ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£!</div>
                    <div style="font-size: 0.9rem; opacity: 0.9; line-height: 1.4;">
                        ${message}
                    </div>
                </div>
                <button onclick="this.parentElement.parentElement.remove()" 
                        style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 1.2rem; cursor: pointer; padding: 0; margin: 0; line-height: 1; flex-shrink: 0;" 
                        title="ÿ•ÿ∫ŸÑÿßŸÇ">
                    √ó
                </button>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            if (notification.parentNode) {
                notification.style.animation = 'slideOutSuccess 0.4s ease-in';
                setTimeout(() => notification.remove(), 400);
            }
        }, 5000);
        
        addNotificationStyles();
    }
    
    // ÿØÿßŸÑÿ© ŸÖÿπÿßŸÑÿ¨ÿ© ŸÜŸÇÿ±ÿ© ÿ≤ÿ± ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑÿ≥ŸÑÿ© - ŸÖÿ≠ÿ≥ŸëŸÜÿ©
    function handleAddToCartClick(button) {
        if (button.disabled || button.classList.contains('processing')) return;
        
        console.log('üîÑ ŸÖÿπÿßŸÑÿ¨ÿ© ŸÜŸÇÿ±ÿ© ÿ≤ÿ± ÿßŸÑÿ≥ŸÑÿ©');
        
        // ÿ™ÿ£ŸÖŸäŸÜ ÿßŸÑÿ≤ÿ±
        button.classList.add('processing');
        const originalHTML = button.innerHTML;
        const originalStyle = button.style.cssText;
        
        // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ∏Ÿáÿ± ÿßŸÑÿ≤ÿ±
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ•ÿ∂ÿßŸÅÿ©...';
        button.disabled = true;
        button.style.background = '#95a5a6';
        button.style.transform = 'scale(0.95)';
        button.style.transition = 'all 0.3s ease';
        
        // ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸÜÿ™ÿ¨
        let productData = null;
        
        try {
            // ÿßŸÑÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿ£ŸàŸÑŸâ: ŸÖŸÜ data-product
            const dataProduct = button.getAttribute('data-product');
            if (dataProduct) {
                try {
                    productData = JSON.parse(dataProduct);
                    console.log('üì¶ ÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ data-product:', productData);
                } catch (e) {
                    console.warn('‚ö†Ô∏è ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ data-product:', e);
                }
            }
            
            // ÿßŸÑÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿ´ÿßŸÜŸäÿ©: ŸÖŸÜ ÿßŸÑÿ®ÿ∑ÿßŸÇÿ© ÿßŸÑŸÖÿ≠Ÿäÿ∑ÿ©
            if (!productData) {
                const card = button.closest('.product-card, .product-item, .item, [data-product-id]');
                if (card) {
                    const title = card.querySelector('.product-title, .item-title, .title, h3, h2')?.textContent?.trim();
                    const priceElement = card.querySelector('.current-price, .sale-price, .price, .cost');
                    const originalPriceElement = card.querySelector('.original-price, .old-price');
                    const imageElement = card.querySelector('.product-image, .item-image, img');
                    
                    const price = priceElement ? priceElement.textContent.replace(/[^0-9.]/g, '') || '0' : '0';
                    const originalPrice = originalPriceElement ? originalPriceElement.textContent.replace(/[^0-9.]/g, '') || price : price;
                    const image = imageElement ? imageElement.src || imageElement.getAttribute('data-src') : '';
                    const productId = card.getAttribute('data-product-id') || 
                                    card.getAttribute('data-id') || 
                                    card.id ||
                                    Date.now().toString();
                    
                    productData = {
                        id: productId,
                        title: title || 'ŸÖŸÜÿ™ÿ¨ ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ',
                        price: originalPrice,
                        sale_price: price,
                        image_link: image,
                        image: image
                    };
                    
                    console.log('üì¶ ÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ ÿßŸÑÿ®ÿ∑ÿßŸÇÿ©:', productData);
                }
            }
            
            // ÿßŸÑÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿ´ÿßŸÑÿ´ÿ©: ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
            if (!productData || !productData.title) {
                productData = {
                    id: 'unknown-' + Date.now(),
                    title: 'ŸÖŸÜÿ™ÿ¨ ŸÖŸÜ ŸÖÿ™ÿ¨ÿ± ŸáÿØÿßŸäÿß ÿßŸÑÿ•ŸÖÿßÿ±ÿßÿ™',
                    price: '99',
                    sale_price: '89',
                    image_link: 'https://via.placeholder.com/300x300/D4AF37/FFFFFF?text=ŸáÿØÿßŸäÿß+ÿßŸÑÿ•ŸÖÿßÿ±ÿßÿ™',
                    image: 'https://via.placeholder.com/300x300/D4AF37/FFFFFF?text=ŸáÿØÿßŸäÿß+ÿßŸÑÿ•ŸÖÿßÿ±ÿßÿ™'
                };
                
                console.log('üì¶ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©:', productData);
            }
            
        } catch (error) {
            console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸÜÿ™ÿ¨:', error);
        }
        
        // ŸÖÿ≠ÿßŸàŸÑÿ© ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨ ŸÑŸÑÿ≥ŸÑÿ©
        setTimeout(() => {
            const success = addToCartSafe(productData);
            
            if (success) {
                // ŸÜÿ¨ÿ≠ÿ™ ÿßŸÑÿπŸÖŸÑŸäÿ©
                button.innerHTML = '<i class="fas fa-check"></i> ÿ™ŸÖ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ©!';
                button.style.background = '#27ae60';
                button.style.color = 'white';
                button.style.transform = 'scale(1)';
                
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    button.style.cssText = originalStyle;
                    button.disabled = false;
                    button.classList.remove('processing');
                }, 2500);
                
            } else {
                // ŸÅÿ¥ŸÑÿ™ ÿßŸÑÿπŸÖŸÑŸäÿ©
                button.innerHTML = '<i class="fas fa-exclamation-triangle"></i> ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ';
                button.style.background = '#e74c3c';
                button.style.color = 'white';
                button.style.transform = 'scale(1)';
                
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    button.style.cssText = originalStyle;
                    button.disabled = false;
                    button.classList.remove('processing');
                }, 3000);
            }
        }, 1000); // ÿ™ÿ£ÿÆŸäÿ± ŸÑŸÖÿ≠ÿßŸÉÿßÿ© ŸÖÿπÿßŸÑÿ¨ÿ©
    }
    
    // ÿØÿßŸÑÿ© ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÜŸäŸÖŸäÿ¥ŸÜ CSS
    function addNotificationStyles() {
        if (!document.querySelector('#cart-notification-styles')) {
            const style = document.createElement('style');
            style.id = 'cart-notification-styles';
            style.textContent = `
                @keyframes slideInSuccess {
                    from { transform: translateX(100%) scale(0.8); opacity: 0; }
                    to { transform: translateX(0) scale(1); opacity: 1; }
                }
                @keyframes slideOutSuccess {
                    from { transform: translateX(0) scale(1); opacity: 1; }
                    to { transform: translateX(100%) scale(0.8); opacity: 0; }
                }
                @keyframes checkmark {
                    0% { transform: scale(0) rotate(-45deg); }
                    50% { transform: scale(1.2) rotate(0deg); }
                    100% { transform: scale(1) rotate(0deg); }
                }
                
                .cart-badge, .cart-counter {
                    position: absolute;
                    top: -8px;
                    left: -8px;
                    background: #e74c3c;
                    color: white;
                    border-radius: 50%;
                    width: 20px;
                    height: 20px;
                    font-size: 11px;
                    font-weight: bold;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 2;
                    transition: all 0.3s ease;
                }
                
                .cart-badge.has-items, .cart-counter.has-items {
                    animation: cartPulse 2s infinite;
                }
                
                @keyframes cartPulse {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.15); }
                }
                
                .btn-add-cart, .btn-add-to-cart, .add-to-cart-btn {
                    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
                    position: relative;
                }
                
                .btn-add-cart:hover, .btn-add-to-cart:hover, .add-to-cart-btn:hover {
                    transform: translateY(-2px) scale(1.02) !important;
                }
                
                .btn-add-cart:active, .btn-add-to-cart:active, .add-to-cart-btn:active {
                    transform: translateY(0) scale(0.98) !important;
                }
                
                .btn-add-cart.processing, .btn-add-to-cart.processing, .add-to-cart-btn.processing {
                    pointer-events: none;
                }
                
                @media (max-width: 768px) {
                    .success-notification, .error-notification {
                        right: 10px;
                        left: 10px;
                        max-width: none;
                        top: 70px;
                    }
                }
            `;
            document.head.appendChild(style);
        }
    }
    
    // ÿØÿßŸÑÿ© ÿ™ŸÅÿπŸäŸÑ ŸÖÿ≥ÿ™ŸÖÿπŸä ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ±
    function initCartButtonListeners() {
        // ÿ™ŸÅŸàŸäÿ∂ ÿßŸÑÿ£ÿ≠ÿØÿßÿ´ ŸÑŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿØŸäŸÜÿßŸÖŸäŸÉŸäÿ©
        document.addEventListener('click', function(e) {
            const addButton = e.target.closest(
                '.btn-add-to-cart, .btn-add-cart, .add-to-cart-btn, [onclick*="addToCart"]'
            );
            
            if (addButton && !addButton.classList.contains('processing')) {
                e.preventDefault();
                e.stopPropagation();
                
                console.log('üéØ ÿ™ŸÖ ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑÿ≥ŸÑÿ©:', addButton);
                handleAddToCartClick(addButton);
            }
        });
        
        console.log('‚úÖ ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ŸÖÿ≥ÿ™ŸÖÿπŸä ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ≥ŸÑÿ©');
    }
    
    // ÿØÿßŸÑÿ© ÿßŸÑÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
    function initCartSystem() {
        console.log('üõçÔ∏è ÿ™ŸáŸäÿ¶ÿ© ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ≥ŸÑÿ© ÿßŸÑŸÖŸèÿµÿ≠ÿ≠...');
        
        addNotificationStyles();
        updateCartCounter();
        initCartButtonListeners();
        
        console.log('‚úÖ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ≥ŸÑÿ© ÿßŸÑŸÖŸèÿµÿ≠ÿ≠ ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿπŸÖŸÑ');
    }
    
    // ÿ™ÿµÿØŸäÿ± ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿÆÿßÿ±ÿ¨Ÿä
    window.addToCart = addToCartSafe;
    window.updateCartCounter = updateCartCounter;
    window.showSuccessNotification = showSuccessNotification;
    window.showErrorNotification = showErrorNotification;
    window.CartSystem = {
        addToCart: addToCartSafe,
        updateCartCounter,
        showSuccessNotification,
        showErrorNotification,
        handleAddToCartClick,
        initCartButtonListeners,
        CART_STORAGE_KEY
    };
    
    // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÜÿ∏ÿßŸÖ
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initCartSystem);
    } else {
        initCartSystem();
    }
    
    // ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ŸÖÿπ ÿ™ÿ≠ÿØŸäÿ´ ÿ™ŸÑŸÇÿßÿ¶Ÿä ŸÑŸÑÿπÿØÿßÿØ
    window.addEventListener('storage', function(e) {
        if (e.key === CART_STORAGE_KEY) {
            updateCartCounter();
        }
    });
    
    // ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ŸÖÿπ ŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿπÿØÿßÿØ ÿπŸÜÿØ ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿµŸÅÿ≠ÿ©
    window.addEventListener('pageshow', function(event) {
        updateCartCounter();
    });
    
})();